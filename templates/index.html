<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SySMon Dashboard</title>
  <!-- Botstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Chart for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<div class="container py-4">
  <h1 class="mb-4 text-center">SySMon â€” Server Monitor</h1>

  <!-- Summary section with uptime, CPU, RAM -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card p-3 shadow-sm text-center">
        <h5>Uptime</h5>
        <p id="uptime">{{ last[4] }}</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3 shadow-sm text-center">
        <h5>CPU</h5>
        <p id="cpu">{{ last[2] }} %</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3 shadow-sm text-center">
        <h5>RAM</h5>
        <p id="ram">{{ last[3] }} %</p>
      </div>
    </div>
  </div>

  <!-- Logs -->
  <div class="card p-3 shadow-sm mb-4">
    <h5>System Logs</h5>
    <pre id="logs">{{ last[5] }}</pre>
  </div>

  <!-- Chart section -->
  <div class="card p-3 shadow-sm">
    <h5>CPU / RAM usage (last 24 records)</h5>
    <canvas id="metricsChart"></canvas>
    <div class="mt-2">
      <!-- Buttons to toggle datasets on/off -->
      <button id="toggleCPU" class="btn btn-sm btn-outline-danger">Toggle CPU</button>
      <button id="toggleRAM" class="btn btn-sm btn-outline-primary">Toggle RAM</button>
    </div>
  </div>
</div>

<script>
// ===== Data from flask  =====
const labels = {{ labels|tojson }};
const cpuData = {{ cpu_data|tojson }};
const ramData = {{ ram_data|tojson }};

// ===== Create Chart.js line chart =====
const ctx = document.getElementById('metricsChart');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: labels,
    datasets: [
      {
        label: 'CPU %',
        data: cpuData,
        borderColor: 'red',
        borderWidth: 2,
        fill: false,
        tension: 0.2  // smooth line
      },
      {
        label: 'RAM %',
        data: ramData,
        borderColor: 'blue',
        borderWidth: 2,
        fill: false,
        tension: 0.2
      }
    ]
  },
  options: {
    responsive: true,
    animation: {
      duration: 1500, // animation on load
      easing: 'easeOutBounce'
    },
    plugins: {
      legend: {
        labels: { color: 'black' }
      }
    }
  }
});

// ===== Auto-refresh the page every 30 seconds =====
setInterval(() => {
  location.reload();
}, 30000);

// ===== Toggle CPU dataset on/off =====
document.getElementById("toggleCPU").addEventListener("click", () => {
  const cpuDataset = chart.data.datasets[0];
  cpuDataset.hidden = !cpuDataset.hidden;
  chart.update();
});

// ===== Toggle RAM dataset on/off =====
document.getElementById("toggleRAM").addEventListener("click", () => {
  const ramDataset = chart.data.datasets[1];
  ramDataset.hidden = !ramDataset.hidden;
  chart.update();
});
</script>

</body>
</html>

